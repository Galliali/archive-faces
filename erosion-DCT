{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":126},"id":"I6FE0mVM42ji","outputId":"36ca3e2e-091d-488c-fbe6-4ea0c191620d","executionInfo":{"status":"ok","timestamp":1768837104142,"user_tz":-60,"elapsed":594780,"user":{"displayName":"Sara Gallego (GALLIALI)","userId":"09265643022910334429"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["üéû Creando GLITCH DCT ORG√ÅNICO en Blanco y Negro...\n","‚úî Fase org√°nica completada.\n","üé• V√≠deo creado: frames_bn/my_video_bw.mp4\n","üì¶ ZIP creado: frames_bn.zip\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["\n","    async function download(id, filename, size) {\n","      if (!google.colab.kernel.accessAllowed) {\n","        return;\n","      }\n","      const div = document.createElement('div');\n","      const label = document.createElement('label');\n","      label.textContent = `Downloading \"${filename}\": `;\n","      div.appendChild(label);\n","      const progress = document.createElement('progress');\n","      progress.max = size;\n","      div.appendChild(progress);\n","      document.body.appendChild(div);\n","\n","      const buffers = [];\n","      let downloaded = 0;\n","\n","      const channel = await google.colab.kernel.comms.open(id);\n","      // Send a message to notify the kernel that we're ready.\n","      channel.send({})\n","\n","      for await (const message of channel.messages) {\n","        // Send a message to notify the kernel that we're ready.\n","        channel.send({})\n","        if (message.buffers) {\n","          for (const buffer of message.buffers) {\n","            buffers.push(buffer);\n","            downloaded += buffer.byteLength;\n","            progress.value = downloaded;\n","          }\n","        }\n","      }\n","      const blob = new Blob(buffers, {type: 'application/binary'});\n","      const a = document.createElement('a');\n","      a.href = window.URL.createObjectURL(blob);\n","      a.download = filename;\n","      div.appendChild(a);\n","      a.click();\n","      div.remove();\n","    }\n","  "]},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["download(\"download_f292aa25-a88a-4c94-af6b-c3675ebcf57b\", \"frames_bn.zip\", 7796338)"]},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["/content/frames_bn.zip"],"text/html":["<a href='frames_bn.zip' target='_blank'>frames_bn.zip</a><br>"]},"metadata":{},"execution_count":1}],"source":["import numpy as np\n","from PIL import Image, ImageFilter\n","import os, shutil, subprocess\n","from IPython.display import FileLink\n","\n","\n","def to_bw(img):\n","    \"\"\"Conviertir imagen RGB a b/n\"\"\"\n","    arr = np.array(img).astype(np.float32)\n","    Y = (0.299*arr[:,:,0] + 0.587*arr[:,:,1] + 0.114*arr[:,:,2])\n","    Y = np.clip(Y, 0, 255).astype(np.uint8)\n","    return Image.fromarray(np.stack([Y, Y, Y], axis=2))\n","\n","\n","input_path = \"sample_data/alvaro.jpeg\"\n","frames_bn = \"frames_bn\"\n","total_frames = 1200\n","\n","# Limpiar carpeta\n","if os.path.exists(frames_bn):\n","    shutil.rmtree(frames_bn)\n","os.makedirs(frames_bn)\n","\n","img_current = Image.open(input_path).convert(\"RGB\")\n","\n","print(\"üéû Creando GLITCH DCT ORG√ÅNICO en Blanco y Negro...\")\n","\n","\n","# ============================================================\n","# TABLA BASE DE DCT\n","# ============================================================\n","\n","q_table_base = np.array([\n","    [8,12,20,28,40,60,80,120],\n","    [12,16,24,32,48,72,96,140],\n","    [20,24,32,40,60,90,120,160],\n","    [28,32,40,50,70,110,150,200],\n","    [40,48,60,70,110,160,220,255],\n","    [60,72,90,110,160,220,255,255],\n","    [80,96,120,150,220,255,255,255],\n","    [120,140,160,200,255,255,255,255]\n","], dtype=float)\n","\n","\n","\n","# ============================================================\n","# LOOP PRINCIPAL\n","# ============================================================\n","\n","for i in range(total_frames):\n","\n","    out_path = f\"{frames_bn}/frame_{i:05d}.jpg\"\n","\n","    # Frame 0\n","    if i == 0:\n","        img_bw = to_bw(img_current)\n","        img_bw.save(out_path, \"JPEG\", quality=98, subsampling=0)\n","        img_current = Image.open(out_path)\n","        continue\n","\n","    # 1) DEFORMACI√ìN\n","    arr = np.array(img_current).astype(np.float32)\n","    if i > 5:\n","        arr = np.roll(arr, np.random.randint(-3,4), axis=0)\n","        arr = np.roll(arr, np.random.randint(-3,4), axis=1)\n","    img_current = Image.fromarray(arr.astype(np.uint8))\n","\n","    # 2) RUIDO\n","    if i < 40: noise_amp = 0.4\n","    elif i < 120: noise_amp = 1.0\n","    else: noise_amp = 2.0\n","    arr = np.array(img_current).astype(np.float32)\n","    arr = np.clip(arr + np.random.normal(0, noise_amp, arr.shape), 0, 255)\n","    img_current = Image.fromarray(arr.astype(np.uint8))\n","\n","    # 3) BLUR\n","    img_current = img_current.filter(ImageFilter.GaussianBlur(radius=1.3))\n","\n","    # 4) SHARPEN\n","    if i % 25 == 0 and i > 50:\n","        img_current = img_current.filter(\n","            ImageFilter.UnsharpMask(radius=2, percent=180)\n","        )\n","\n","    # 5) B/N\n","    img_current = to_bw(img_current)\n","\n","    # 6) DCT\n","    q_table = q_table_base * (1 + np.random.normal(0, 0.25, (8,8)))\n","\n","    if i < 40: grow = np.random.uniform(1.01, 1.03)\n","    elif i < 120: grow = np.random.uniform(1.03, 1.10)\n","    else: grow = np.random.uniform(1.10, 1.25)\n","\n","    q_table = np.clip(q_table * grow, 1, 255)\n","    q_flat = q_table.astype(np.uint8).flatten().tolist()\n","\n","    img_current.save(\n","        out_path,\n","        \"JPEG\",\n","        qtables=[q_flat, q_flat, q_flat],\n","        subsampling=2,\n","        quality=1\n","    )\n","\n","    img_current = Image.open(out_path)\n","\n","print(\"‚úî Fase org√°nica completada.\")\n","\n","\n","\n","# ============================================================\n","# FASE 3 ‚Äî CREAR VIDEO DESDE frames_bn\n","# ============================================================\n","\n","def create_video_from_frames(folder, fps=6, output_name=\"video_bw.mp4\"):\n","    video_path = os.path.join(folder, output_name)\n","\n","    subprocess.run([\n","        \"ffmpeg\",\n","        \"-y\",\n","        \"-framerate\", str(fps),\n","        \"-i\", os.path.join(folder, \"frame_%05d.jpg\"),\n","        \"-c:v\", \"libx264\",\n","        \"-pix_fmt\", \"yuv420p\",\n","        video_path\n","    ], check=True)\n","\n","    print(\"üé• V√≠deo creado:\", video_path)\n","    return FileLink(video_path)\n","\n","video_link = create_video_from_frames(frames_bn, fps=6, output_name=\"my_video_bw.mp4\")\n","video_link\n","\n","\n","\n","# ============================================================\n","# FASE 4 ‚Äî CREAR ZIP DE FRAMES_BN\n","# ============================================================\n","\n","FRAMES_FOLDER_ZIP = frames_bn\n","zip_path = FRAMES_FOLDER_ZIP + \".zip\"\n","\n","shutil.make_archive(FRAMES_FOLDER_ZIP, 'zip', FRAMES_FOLDER_ZIP)\n","print(\"üì¶ ZIP creado:\", zip_path)\n","\n","try:\n","    from google.colab import files\n","    files.download(zip_path)\n","except:\n","    pass\n","\n","FileLink(zip_path)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":116876,"status":"ok","timestamp":1764962381889,"user":{"displayName":"Sara Galliali","userId":"09265643022910334429"},"user_tz":-60},"id":"uy8dnjmc8tn7","outputId":"11597123-7a91-4b81-ae5c-d22f4b975145"},"outputs":[{"name":"stdout","output_type":"stream","text":["\n","üü¶ Iniciando conversi√≥n a PPM ASCII reducido...\n","\n","‚úî Conversi√≥n a PPM ASCII reducida completada.\n","‚Üí Archivos guardados en: ppm_ascii\n","\n","üéû Creando video a partir de los PPM reducidos...\n","\n","üé• V√≠deo generado con √©xito: ppm_reduced_video.mp4\n","Fin del post-procesado PPM + v√≠deo.\n","\n"]}],"source":["# ============================================================\n","# POST-PROCESADO: CONVERTIR FRAMES A PPM ASCII (REDUCIDO)\n","# ============================================================\n","\n","import numpy as np\n","from PIL import Image\n","import os\n","import subprocess\n","\n","print(\"\\nüü¶ Iniciando conversi√≥n a PPM ASCII reducido...\\n\")\n","\n","# Carpeta con tus frames ya generados\n","FRAMES_FOLDER = \"frames_bn\"\n","PPM_FOLDER = \"ppm_ascii\"\n","os.makedirs(PPM_FOLDER, exist_ok=True)\n","\n","# Convertir solo 1 de cada N frames\n","STEP = 10   # <-- ajusta aqu√≠ si quieres m√°s o menos frames\n","\n","def save_ppm_ascii(img, path):\n","    arr = np.array(img)\n","    h, w, _ = arr.shape\n","\n","    with open(path, \"w\") as f:\n","        f.write(\"P3\\n\")\n","        f.write(f\"{w} {h}\\n\")\n","        f.write(\"255\\n\")\n","        for y in range(h):\n","            row = []\n","            for x in range(w):\n","                r, g, b = arr[y, x]\n","                row.append(f\"{r} {g} {b}\")\n","            f.write(\" \".join(row) + \"\\n\")\n","\n","frames = sorted(f for f in os.listdir(FRAMES_FOLDER) if f.endswith(\".jpg\"))\n","\n","for idx, fname in enumerate(frames):\n","    if idx % STEP != 0:\n","        continue\n","\n","    in_path = os.path.join(FRAMES_FOLDER, fname)\n","    img = Image.open(in_path).convert(\"RGB\")\n","\n","    out_name = fname.replace(\".jpg\", \".ppm\")\n","    out_path = os.path.join(PPM_FOLDER, out_name)\n","\n","    save_ppm_ascii(img, out_path)\n","\n","print(\"‚úî Conversi√≥n a PPM ASCII reducida completada.\")\n","print(f\"‚Üí Archivos guardados en: {PPM_FOLDER}\")\n","\n","\n","# ============================================================\n","# CREAR VIDEO DESDE LOS PPM REDUCIDOS\n","# ============================================================\n","\n","print(\"\\nüéû Creando video a partir de los PPM reducidos...\\n\")\n","\n","# ffmpeg no lee PPM ASCII directamente ‚Üí convertimos PPM a PNG temporalmente\n","PNG_FOLDER = \"ppm_png\"\n","os.makedirs(PNG_FOLDER, exist_ok=True)\n","\n","ppm_files = sorted(f for f in os.listdir(PPM_FOLDER) if f.endswith(\".ppm\"))\n","\n","# Convertir ppm ‚Üí png para ffmpeg\n","for fname in ppm_files:\n","    ppm_path = os.path.join(PPM_FOLDER, fname)\n","    png_path = os.path.join(PNG_FOLDER, fname.replace(\".ppm\", \".png\"))\n","\n","    img = Image.open(ppm_path)\n","    img.save(png_path, \"PNG\")\n","\n","# Crear v√≠deo\n","VIDEO_OUT = \"ppm_reduced_video.mp4\"\n","\n","subprocess.run([\n","    \"ffmpeg\",\n","    \"-y\",\n","    \"-framerate\", \"6\",\n","    \"-i\", os.path.join(PNG_FOLDER, \"frame_%05d.png\"),\n","    \"-c:v\", \"libx264\",\n","    \"-pix_fmt\", \"yuv420p\",\n","    VIDEO_OUT\n","])\n","\n","print(f\"üé• V√≠deo generado con √©xito: {VIDEO_OUT}\")\n","print(\"Fin del post-procesado PPM + v√≠deo.\\n\")\n"]}],"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyO174FpnTN9sQm4qJHQDHGI"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}